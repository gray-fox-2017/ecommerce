<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Buku Lapuk- Lapak Buku Bekas</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="./css/styles.css">
    <script src="https://unpkg.com/vue"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>
  </head>
  <body>
    <div id="app">
    <header>
      <nav class="navbar navbar-default">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="#">Buku Lapuk</a>
          </div>
          <ul class="nav navbar-nav navbar-right">
            <li class="active"><a href="#">Beranda</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Profil Anda <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Lihat Profil</a></li>
                <li><a href="#">Transaksi Terdahulu</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Ubah Pengaturan Profil</a></li>
              </ul>
            </li>
            <li><a href="checkout.html">Keranjang</a></li>
            <li><a href="#">Kontak</a></li>
          </ul>
        </div>
      </nav>
    </header>
    <div class="container">
      <div class="row">
        <div class="col-xs-12 col-md-6">
          <h5>Masukkan buku yang anda cari</h5>
          <div class="form-group">
            <label for="cari">Cari:</label>
            <input type="text" class="form-control" id="cari">
          </div>
          <div class="form-group">
            <label for="kategori">Kategori:</label>
            <select class="form-control" id="kategori">
             <option>Fiksi</option>
             <option>Non-Fiksi</option>
             <option>Sejarah</option>
             <option>Biografi</option>
             <option>Pendidikan</option>
            </select>
          </div>
          <div class="form-group">
            <button type="submit" name="button" class="btn btn-primary">Cari</button>
          </div>
        </div>
        <div class="col-xs-12 col-md-6">
        <div id="myCarousel" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
          </ol>
          <div class="carousel-inner">
            <div class="item active">
              <img class="img-responsive"src="./images/banner1.jpg" alt="Promo Ongkir">
            </div>

            <div class="item">
              <img class="img-responsive"src="./images/banner2.jpg" alt="Chicago">
            </div>
            <a class="left carousel-control" href="#myCarousel" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left"></span>
              <span class="sr-only">Sebelumnya</span>
            </a>
            <a class="right carousel-control" href="#myCarousel" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right"></span>
              <span class="sr-only">Selanjutnya</span>
            </a>
          </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container isinya">
      <div class="row">
        <div class="col-md-2 sidebar">
          <h4>Kategori</h4>
          <ul class="list-group">
            <li class="list-group-item"><a href="#">Fiksi</a></li>
            <li class="list-group-item"><a href="#">Non-Fiksi</a></li>
            <li class="list-group-item"><a href="#">Sejarah</a></li>
            <li class="list-group-item"><a href="#">Biografi</a></li>
            <li class="list-group-item"><a href="#">Pendidikan</a></li>
          </ul>
          <button v-if="cart.length > 0" v-on:click="calculateTotal()" type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#myModal">
          <span class="glyphicon glyphicon-shopping-cart"></span> Keranjang ({{ cart.length }})
          </button>
            <!-- Modal -->
            <div id="myModal" class="modal fade" role="dialog">
              <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                  </div>
                  <div class="modal-body">
                    <div class="panel panel-default">
              				<div class="panel-heading">
              					<div class="panel-title">
              						<div class="row">
              							<div class="col-xs-6">
              								<h4>Keranjang Belanja Anda</h4>
              							</div>
              						</div>
              					</div>
              				</div>
              				<div class="panel-body">
              					<div class="row" v-for="(belanjaan, index) in cart">
              						<div class="col-xs-2"><img class="img-responsive" v-bind:src="belanjaan.image">
              						</div>
              						<div class="col-xs-4">
              							<p class="book-name">{{ belanjaan.title }}</p>
                            <p class="book-genre"><small>{{ belanjaan.genre }}</small></p>
              						</div>
              						<div class="col-xs-6">
              							<div class="col-xs-6 text-right">
              								<p class="book-price"><strong>Rp {{ belanjaan.price }}<span class="text-muted"> x</span></strong></p>
              							</div>
              							<div class="col-xs-4">
              								<input type="text" class="form-control input-sm" v-model="belanjaan.count">
              							</div>
              							<div class="col-xs-2">
              								<button type="button" class="btn btn-link btn-xs" v-on:click="removeItem(index)">
              									<span class="glyphicon glyphicon-trash"> </span>
              								</button>
              							</div>
              						</div>
              					</div>
              					<hr>
              					<hr>
              					<div class="row">
              						<div class="text-center">
              							<div class="col-xs-9">
              								<h6 class="text-right">Tambah barang?</h6>
              							</div>
              							<div class="col-xs-3">
              								<button type="button" v-on:click="calculateTotal()" class="btn btn-default btn-sm btn-block">
              									Update
              								</button>
              							</div>
              						</div>
              					</div>
              				</div>
              				<div class="panel-footer">
              					<div class="row text-center">
              						<div class="col-xs-9">
              							<h4 class="text-right">Total <strong>Rp {{ total }}</strong></h4>
              						</div>
              						<div class="col-xs-3">
              							<button type="button" class="btn btn-success btn-block">
              								Checkout
              							</button>
              						</div>
              					</div>
              				</div>
              			</div>
                  </div>
                </div>
              </div>
            </div>
        </div>
        <div class="col-md-offset-1 col-md-9">
          <h4>Rekomendasi Buku</h4>
          <div class="row">
              <div class="col-md-4" v-for="book in bookList">
                <div class="panel panel-default">
                  <div class="panel-heading">
                    <div class="image-buku">
                      <img v-bind:src="book.image" class="img-responsive img-rounded" alt="">
                    </div>
                  </div>
                  <div class="panel-body">
                    <h5 class="book-name">{{ book.title }}</h5>
                    <p class="book-author">Penulis: {{ book.author }}</p>
                    <p class="book-price">Rp {{ book.price }}</p>
                    <p class="book-genre">Genre: {{ book.genre }}</p>
                    <button type="button" name="add-item" class="btn btn-default" v-on:click="addToCart(book)">Tambahkan</button>
                  </div>
                </div>
              </div>
          </div>
        </div>
      </div>
    </div>
    </div>
    <script type="text/javascript">
      var app = new Vue({
        el: '#app',
        data: {
          bookList: [],
          cart: [],
          total: 0
        },
        created: function() {
          this.populateBook();
        },
        methods: {
          populateBook: function() {
            var self = this;
            axios.get('http://localhost:3000/api/books')
            .then((response) => {
              self.bookList = response.data;
            })
          },
          addToCart: function(item) {
            let data = this.cart;
            let already = 0;
            if(!item.count) item.count = 1;
            for(let i = 0; i < data.length; i++) {
              if(data[i] == item) {
                already++;
              }
            }
            if(already === 0) data.push(item)
          },
          calculateTotal: function() {
            let total = 0;
            this.cart.forEach(belanjaan => {
              total += (belanjaan.count * belanjaan.price);
            })
            app.total = total;
          },
          removeItem: function(index) {
            app.cart.splice(index, 1)
          }
        }
      })
    </script>
  </body>
</html>